#!/usr/bin/env ruby

require 'rubygems'
require 'optparse'
require 'terminal-table'
require File.expand_path('../../lib/f1results.rb', __FILE__)

year       = Time.now.year
country    = ''
event_type = :race

optparse = OptionParser.new do |opts|
  opts.on('-y', '--year=YEAR', Integer)      { |val| year = val }
  opts.on('-c', '--country=COUNTRY', String) { |val| country = val.downcase }
  opts.on('-e', '--event=EVENT', String)     { |val| event_type = val.downcase.to_sym }
  opts.parse!
end

event = F1Results.get(year, country, event_type)
if event.results.empty?
  puts "No results for #{year} #{country} #{event_type}"
  exit
end

title = "#{event.year} #{event.country_name} #{event.type_name}\n#{event.name}"
table = Terminal::Table.new title: title, rows: event.to_a

if event.practice?
  table.headings = %W(Pos Num Driver Team Time Gap Laps)
  table.align_column 0, :right
  table.align_column 1, :right
  table.align_column 4, :right
  table.align_column 6, :right

elsif event.qualifying?
  table.headings = %W(Pos Driver Team Q1 Q2 Q3 Laps)
  table.align_column 0, :right
  table.align_column 6, :right

elsif event.race?
  table.headings = %W(Pos Driver Country Team Time/Retired Points)
  table.align_column 0, :right
  table.align_column 2, :center
  table.align_column 4, :right
  table.align_column 5, :right
end

puts table
